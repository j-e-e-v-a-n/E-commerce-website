<style>
    body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f2f2f2;
            padding: 20px;
        }
        .order-list {
            margin-top: 20px;
        }
        .order-item {
            border: 1px solid #ccc;
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .order-item h2 {
            margin-top: 0;
            font-size: 24px;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .delivery-details {
            margin-top: 15px;
        }
        .delivery-details h3 {
            margin-top: 0;
            font-size: 20px;
            color: #555;
        }
        .status-buttons {
            margin-top: 10px;
        }
        .status-buttons button {
            margin-right: 10px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .status-buttons button:hover {
            background-color: #45a049;
        }
</style>

<h1>All Orders</h1>

<!-- Search Bar -->
<input type="text" id="searchInput" onkeyup="searchOrders()" placeholder="Search for orders...">
<div class="order-list">
    {{#each details}}
    <div class="order-item">
        <h2>Order Details</h2>
        <table>
            <tr>
                <th>Order ID</th>
                <td>{{_id}}</td>
            </tr>
            <tr>
                <th>Status</th>
                <td>
                    {{status}}
                    <div class="status-buttons">
                        <button onclick="changeStatus('{{_id}}', 'hi', 'Order placed')">Order placed</button>
                        <button onclick="changeStatus('{{_id}}', 'hi', 'Order accepted')">Order accepted</button>
                        <button onclick="changeStatus('{{_id}}', 'hi', 'Shipped')">Shipped</button>
                        <button onclick="changeStatus('{{_id}}', 'hi', 'delivered')">Mark Delivered</button>
                        <button onclick="changeStatus('{{_id}}', 'hi', 'cancelled')">Cancel</button>
                    </div>
                </td>
            </tr>
            <tr>
                <th>Date</th>
                <td>{{date}}</td>
            </tr>
        </table>

        <div class="delivery-details">
            <h3>Delivery Details</h3>
            <table>
                <tr>
                    <th>Mobile</th>
                    <td>{{deliveryDetails.mobile}}</td>
                </tr>
                <tr>
                    <th>Address</th>
                    <td>{{deliveryDetails.address}}</td>
                </tr>
                <tr>
                    <th>Pincode</th>
                    <td>{{deliveryDetails.pincode}}</td>
                </tr>
            </table>
        </div>

        <h3>Payment Method</h3>
        <p>{{paymentmethod}}</p>

        <h3>Products</h3>
        <table>
            <tr>
                <th>Item</th>
                <th>Quantity</th>
            </tr>
            {{#each products}}
            <tr>
                <td>{{this.item}}</td>
                <td>{{this.quantity}}</td>
            </tr>
            {{/each}}
        </table>

        <p>Total Amount: ${{totalamount}}</p>
    </div>
    {{/each}}
</div>

<!-- Include jQuery for AJAX and highlighting functionality -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function changeStatus(id, item, status) {
        console.log(id, item, status);
        $.ajax({
            url: '/admin/changeStatus',
            data: {
                id: id,
                item: item,
                status: status,
            },
            method: 'post',
            success: function (response) {
                if (response) {
                    alert("Status updated");
                    location.reload();
                }
            }
        });
    }

    function searchOrders() {
        var input, filter, orderList, orders, txtValue;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase();
        orderList = document.getElementsByClassName('order-item');

        for (var i = 0; i < orderList.length; i++) {
            orders = orderList[i].getElementsByTagName('table')[0];
            txtValue = orders.textContent || orders.innerText;

            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                orderList[i].style.display = "";
            } else {
                orderList[i].style.display = "none";
            }
        }
    }
</script>
